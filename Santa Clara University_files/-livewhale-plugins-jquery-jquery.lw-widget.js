/*      /livewhale/scripts/lib/date/formatter.js      */

if(typeof livewhale==='undefined'){window.livewhale={};}
if(!livewhale.lib)livewhale.lib={};(function(){var $=livewhale.jQuery||jQuery;var Formatter=function(date_obj){this._dt=date_obj;};Formatter.prototype={format:function(format){return format.replace(this._formatChr,$.proxy(this._formatChrCb,this));},_txt_words:["Sun","Mon","Tues","Wednes","Thurs","Fri","Satur","January","February","March","April","May","June","July","August","September","October","November","December"],_formatChr:/\\?(.?)/gi,_formatChrCb:function(t,s){return this[t]?this[t]():s;},_pad:function(n,c){n=String(n);while(n.length<c){n='0'+n;}
return n;},d:function(){return this._pad(this.j(),2);},D:function(){return this.l().slice(0,3);},j:function(){return this._dt.getDate();},l:function(){return this._txt_words[this.w()]+'day';},N:function(){return this.w()||7;},S:function(){var j=this.j(),i=j%10;if(i<=3&&parseInt((j%100)/10,10)===1){i=0;}
return['st','nd','rd'][i-1]||'th';},w:function(){return this._dt.getDay();},z:function(){var a=new Date(this.Y(),this.n()-1,this.j()),b=new Date(this.Y(),0,1);return Math.round((a-b)/864e5);},W:function(){var a=new Date(this.Y(),this.n()-1,this.j()-this.N()+3),b=new Date(a.getFullYear(),0,4);return this._pad(1+Math.round((a-b)/864e5/7),2);},F:function(){return this._txt_words[6+this.n()];},m:function(){return this._pad(this.n(),2);},M:function(){return this.F().slice(0,3);},n:function(){return this._dt.getMonth()+1;},t:function(){return(new Date(this.Y(),this.n(),0)).getDate();},L:function(){var j=this.Y();return j%4===0&j%100!==0|j%400===0;},o:function(){var n=this.n(),W=this.W(),Y=this.Y();return Y+(n===12&&W<9?1:n===1&&W>9?-1:0);},Y:function(){return this._dt.getFullYear();},y:function(){return this.Y().toString().slice(-2);},a:function(){return this._dt.getHours()>11?"pm":"am";},A:function(){return this.a().toUpperCase();},B:function(){return'';},g:function(){return this.G()%12||12;},G:function(){return this._dt.getHours();},h:function(){return this._pad(this.g(),2);},H:function(){return this._pad(this.G(),2);},i:function(){return this._pad(this._dt.getMinutes(),2);},s:function(){return this._pad(this._dt.getSeconds(),2);},u:function(){return this._pad(this._dt.getMilliseconds()*1000,6);},e:function(){throw'Not supported (see source code of date() for timezone on how to add support)';},I:function(){var a=new Date(this.Y(),0),c=Date.UTC(this.Y(),0),b=new Date(this.Y(),6),d=Date.UTC(this.Y(),6);return((a-c)!==(b-d))?1:0;},O:function(){var tzo=this._dt.getTimezoneOffset(),a=Math.abs(tzo);return(tzo>0?"-":"+")+this._pad(Math.floor(a/60)*100+a%60,4);},P:function(){var O=this.O();return(O.substr(0,3)+":"+O.substr(3,2));},Z:function(){return-this._dt.getTimezoneOffset()*60;},c:function(){return'Y-m-d\\TH:i:sP'.replace(this._formatChr,this._formatChrCb);},r:function(){return'D, d M Y H:i:s O'.replace(this._formatChr,this._formatChrCb);},U:function(){return this._dt._date/1000|0;}};livewhale.lib.DateFormatter=Formatter;}());

/*      /livewhale/scripts/lib/date/timezone.js      */

if(typeof livewhale==='undefined'){window.livewhale={};}
if(!livewhale.lib)livewhale.lib={};(function(){var Timezone=function(timestamp,tz_offset){this._date=new Date((parseInt(timestamp,10)*1000)+(parseInt(tz_offset,10)*1000));this._formatter=new livewhale.lib.DateFormatter(this);};Timezone.time_format={us:null,euro:null};Timezone.date_format={us:null,euro:null};Timezone.user_format_zone='us';Timezone.setUserFormatZone=function(format_zone){Timezone.user_format_zone=format_zone;};Timezone.getUserFormatZone=function(){return Timezone.user_format_zone;};Timezone.getUserTimeFormat=function(){return(Timezone.time_format[Timezone.user_format_zone])?Timezone.time_format[Timezone.user_format_zone]:'m/d/Y';};Timezone.getUserDateFormat=function(){return(Timezone.date_format[Timezone.user_format_zone])?Timezone.date_format[Timezone.user_format_zone]:'g:ia';};Timezone.prototype={month_names:["January","February","March","April","May","June","July","August","September","October","November","December"],month_names_short:['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],day_names:['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'],getFormattedDate:function(format){return this._formatter.format(format);},getDateObject:function(){return this._date;},getTimeString:function(format_zone){var format=(format_zone&&Timezone.time_format[format_zone])?Timezone.time_format[format_zone]:Timezone.getUserTimeFormat();return this._formatter.format(format);},getShortDateString:function(format_zone){var format=(format_zone&&Timezone.date_format[format_zone])?Timezone.date_format[format_zone]:Timezone.getUserDateFormat();return this._formatter.format(format);},getDateTimeString:function(){return this.month_names_short[this._date.getUTCMonth()]+' '
+this._date.getUTCDate()+', '
+this.getTimeString();},isDayStart:function(){return(0===this.getHours()&&0===this.getMinutes());},getHours:function(){return this._date.getUTCHours();},getMinutes:function(){return this._date.getUTCMinutes();},getSeconds:function(){return this._date.getUTCSeconds();},getMilliseconds:function(){return this._date.getUTCMilliseconds();},getFullYear:function(){return this._date.getUTCFullYear();},getMonth:function(){return this._date.getUTCMonth();},getDate:function(){return this._date.getUTCDate();},getDay:function(){return this._date.getUTCDay();},getTime:function(){return this._date.getTime();},setTimeToZero:function(){this._date.setUTCHours(0);this._date.setUTCMinutes(0);this._date.setUTCSeconds(0);}};livewhale.lib.DateTimezone=Timezone;}());

/*      /livewhale/scripts/lib/date/user.js      */

if(typeof livewhale==='undefined'){window.livewhale={};}
if(!livewhale.lib)livewhale.lib={};(function(){var User=function(){this._user_tz=null;};User.prototype={getTimezone:function(){var dt,tz;if(!this._user_tz){dt=new Date().toString();tz=dt.match(/\(([^\)]+)\)$/)||dt.match(/([A-Z]+) [\d]{4}$/);this._user_tz=(tz)?tz[1].match(/[A-Z]/g).join(''):'EST';}
return this._user_tz;},setTimezone:function(tz){this._user_tz=tz;}};livewhale.lib.DateUser=User;}());

/*      /livewhale/plugins/jquery/jquery.lw-widget.js      */

(function($){var defaults={include_default_styles:false,group_by_date:false,format:'json'};var disable_timezone=false;var User=livewhale.lib.DateUser;var Timezone=livewhale.lib.DateTimezone;function getDefaultResults(opts,format_args,data){var result='';$.each(data.data,function(key,val){var output=data.format,has_image=false,item;$.each(format_args,function(key2,val2){if(val2==='title'&&val.title&&val.url){val.title='<a href="'+val.url+'">'+val.title+'</a>';}
if(val2==='thumbnail'&&val.thumbnail){var img_alt=(val.title)?encodeURIComponent(val.title):'Thumbnail Image';val.thumbnail='<span class="lw_item_thumb">'+(val.url?'<a href="'+val.url+'">':'')
+'<img src="'+val.thumbnail+'" alt="'+img_alt+'"/>'+(val.url?'</a>':'')+'</span>';has_image=true;}
output=output.replace('{'+val2+'}',(val[val2]?val[val2]:''));});result+='<div class="lw_widget_item'+(has_image?' lw_has_image':'')+'">'+output+'</div>';});return result;}
function getEventsResults(opts,format_args,data){var results={},result='';Timezone.time_format[data.group.timezone_format]=data.group.time_format;Timezone.date_format[data.group.timezone_format]=data.group.date_format;Timezone.setUserFormatZone(data.group.timezone_format);$.each(['date_format_header','date_format','time_format'],function(i,format){if(typeof data[format]==='string'){data[format]=data[format].replace(/(^|[^%]{1})%/g,'$1');if(data[format].length>0&&typeof Timezone[format][data.group.timezone_format]!=='undefined'){Timezone[format][data.group.timezone_format]=data[format];}}});function getItem(val){var output=((val.is_starred===1)?data.format_starred:data.format),has_image=false,start_time=new Timezone(val.date_ts,val.tz_offset),end_time=(val.date2_ts)?new Timezone(val.date2_ts,val.tz_offset):null,event_url;if(val.title){val.title_clean=val.title;}else{val.title_clean='';}
if(val.url&&val.url.length>0){event_url=val.url;}else{event_url=null;}
if(data.type==='events'&&val.id&&data.group.directory&&data.group.directory!==opts.host+'/'){event_url=data.group.directory+'#event_id/'+val.id+'/view/event';}
$.each(format_args,function(key2,val2){if(val2==='date'&&end_time&&start_time.getShortDateString()!==end_time.getShortDateString()){if(start_time.getMonth()===end_time.getMonth()){val[val2]=val[val2]+'-'+end_time.getDate();}else{val[val2]=val[val2]+' - '+end_time.getFormattedDate('F d');}}
if(val2==='title'&&val.title&&event_url){val.title='<a href="'+event_url+'" class="lw_events_title">'+val.title+'</a>';}
if(val2==='image'&&val.image){val.image=val.image.replace(/(href|src)="(?!(http|\/\/))(.*?)"/ig,'$1="'+opts.host+'$3"');if(val.image_src){val.image_src=opts.host+val.image_src;}
has_image=true;}
if(val2==='thumbnail'&&val.thumbnail){var img_alt=(val.title)?encodeURIComponent(val.title):'Thumbnail Image';val.thumbnail='<span class="lw_item_thumb">'+(event_url?'<a href="'+event_url+'">':'')+'<img src="'+val.thumbnail+'" alt="'+img_alt+'"/>'+(event_url?'</a>':'')+'</span>';has_image=true;}
if((val2==='summary'||val2==='description')&&val[val2]&&val[val2].match(/<[^>]+(href|src)=[^>]+>/i)){val[val2]=val[val2].replace(/(href|src)="(?!(http|\/\/))(.*?)"/ig,'$1="'+opts.host+'$3"');}
if(val2==='time'){if(val.is_all_day&&(val.is_all_day===true||val.is_all_day==='1'||val.is_all_day===1)){val[val2]='All Day';}else if(val.date_ts){val[val2]=start_time.getTimeString();if(end_time){if(start_time.getShortDateString()===end_time.getShortDateString()){if(start_time.getTimeString()!==end_time.getTimeString()){val[val2]+='&nbsp;&ndash;&nbsp;'+end_time.getTimeString();}}else{val[val2]+=' until '+end_time.getShortDateString()+', '+end_time.getTimeString();}}}}
output=output.replace('{'+val2+'}',(val[val2]?val[val2]:''));});return'<div class="lw_widget_item'+(has_image?' lw_has_image':'')+(val.is_starred?' lw_is_starred':'')+'">'+output+'</div>';}
if(opts.group_by_date){$.each(data.data,function(index,item){var start_time=new Timezone(item.date_ts,item.tz_offset),date=item.date,end_time;if(item.date2_ts){end_time=new Timezone(item.date2_ts,item.tz_offset);if(start_time.getShortDateString()!==end_time.getShortDateString()){if(start_time.getMonth()===end_time.getMonth()){date+='-'+end_time.getDate();}else{date+=' - '+end_time.getFormattedDate('F d');}}}
if(!$.isArray(results[date])){results[date]=[];}
results[date].push(item);});$.each(results,function(date,date_results){result+='<h3>'+date+'</h3>';$.each(date_results,function(i,item){result+=getItem(item);});});}else{$.each(data.data,function(index,item){result+=getItem(item);});}
return result;}
var methods={init:function(options){var plugin=this,opts=$.extend(defaults,options),$body=$('body'),user=new User();return this.each(function(){var $widget=$(this),liveurl,url,request_opts;function replaceCalendarLinks(){if(!opts.link_to_calendar)return;$widget.find('a[href]').each(function(){var $a=$(this),href=$a.attr('href'),id_match=href.match(/\/(\d+)[^\/]*$/),widget_host=opts.host.replace(/^https?:\/\//,'').replace(/\/$/,''),link_host_match=href.match(/^.*:\/\/([A-Za-z0-9\-\.]+)/);if(id_match&&link_host_match&&link_host_match.length===2&&link_host_match[1]===widget_host){$a.attr('href',opts.link_to_calendar+'/#view/event/event_id/'+id_match[1]);}});}
function includeDefaultStyles(type,theme){var css_url;theme=theme||'core';if(opts.theme){theme=opts.theme;}
css_url=opts.host+liveurl+'/resource/css/%5Clivewhale%5Ctheme%5C'+theme
+'%5Cstyles%5C'+type+'-embed-widget.css';$('<link>').appendTo($('head')).attr({type:'text/css',rel:'stylesheet'}).attr('href',css_url);}
$widget.addClass('loading');if(!opts.host||!opts.host.match(/[^\.]+\.[^\.]+/gi)){return this;}
if(!opts.id){return this;}
opts.host=opts.host.replace(/\/$/,'');if(!opts.host.match(/^http/)){opts.host=document.location.protocol+'//'+opts.host;}
liveurl=opts.liveurl_dir||'/live';url=opts.host+liveurl+'/widget/'+opts.id;if(opts.tags){$.each(opts.tags.split(','),function(i,tag){url+='/tag/'+$.trim(tag);});}
if(opts.categories){$.each(opts.categories.split(','),function(i,cat){url+='/category/'+$.trim(cat);});}
if(opts.groups){$.each(opts.groups.split(','),function(i,group){url+='/group/'+$.trim(group);});}
if(opts.max){url+='/max/'+$.trim(opts.max);}
request_opts={type:'GET',timeout:30000,data:{external_widget:1},crossDomain:true};if('json'===opts.format){url+='@JSON';request_opts.dataType='jsonp';request_opts.success=function(data){var format_args=[],results={},result,css_url,$wrapper;$body.trigger('beforeWidgetLoad.lw');$.each((data.format+data.format_starred).match(/\{[^\}]+\}/gi),function(key,val){val=val.replace('{','').replace('}','');if($.inArray(val,format_args)){format_args.push(val);}});if(opts.include_default_styles){includeDefaultStyles(data.type,data.theme);}
$wrapper=$('<div class="lw_widget lw_widget_'+data.type+'"/>');if(!$.isArray(data['class'])){data['class']=[];}
if(opts.group_by_date){data['class'].push('lw_widget_group_by_date');}
$.each(data['class'],function(i,class_name){$wrapper.addClass(class_name);});if(data.data.length){if(data.type==='events'){result=getEventsResults(opts,format_args,data);}else{result=getDefaultResults(opts,format_args,data);}}else{result=data.no_results;}
$wrapper.append(result);$widget.html($wrapper);if(opts.link_to_calendar){replaceCalendarLinks();}
$widget.removeClass('loading');$body.trigger('widgetLoad.lw');};}else{request_opts.dataType='html';request_opts.success=function(data){$body.trigger('beforeWidgetLoad.lw');$widget.html(data);if(opts.link_to_calendar){replaceCalendarLinks();}
$widget.removeClass('loading');$body.trigger('widgetLoad.lw');};}
$.ajax(url,request_opts);$widget.on('click','.lw_paginate a',function(e){e.preventDefault();var href=$(this).attr('href'),opts={},pairs,page;$widget.addClass('loading');href=href.substring(href.lastIndexOf('?'));pairs=href.split('&');$.each(pairs,function(i,pair){var arg=pair.split('=');if(arg[0]==='page'){page=arg[1];}});if(page){$.extend(true,opts,request_opts,{data:{'page':page}});}else{$.extend(true,opts,request_opts,{data:{'all':'1'}});}
$.ajax(url,opts);return true;});});}};$.fn.lwWidget=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1));}else if(typeof method==='object'||!method){return methods.init.apply(this,arguments);}else{$.error('Method '+method+' does not exist on jQuery.lwWidget');return false;}};}(livewhale.jQuery||jQuery));